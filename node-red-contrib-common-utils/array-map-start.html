<script type="text/javascript">
  "use strict";
  /*global RED*/
  RED.nodes.registerType('array-map-start', {
    category: 'function',
    inputs: 1,
    outputs: 1,
    color: "#85C1E9",
    icon: "icons/node-red/white-globe.svg",
    paletteLabel: "array-map-start",
    defaults: {
      name: {
        value: ""
      },
      arrayField: {
        value: 'msg|payload'
      },
      interval: {
        value: 0
      }
    },
    label: function () {
      return this.name || 'Array map start';
    },
    oneditprepare: function () {
      window.utils.makeTypedInput('arrayField', [{
        value: "msg",
        label: "msg."
      }], undefined, this.arrayField);
    }
  });
</script>

<script type="text/html" data-template-name="array-map-start">
  <div class="form-row">
    <label for="node-input-name">Name</label>
    <input type="text" id="node-input-name">
  </div>
  <div class="form-row" id="arrayField">
  </div>
  <div class="form-row">
    <label for="node-input-interval">Interval ms</label>
    <input type="number" id="node-input-interval">
  </div>
</script>

<script type="text/html" data-help-name="array-map-start">
  Expects array or object in <code>Array field</code>, emits event for every element <br/>
  Must be enclosed with array-map-end node<br/>
  For every element in array or object <code>msg</code> will be sent with props:
  <ul>
    <li><code>msg.type</code> - can be an array or an object</li>
    <li><code>msg.payload</code> - current element of an array</li>
    <li><code>msg.index (if it is an array)</code> - index (number) of element in array</li>
    <li><code>msg.key (if it is an object)</code> - key of element in object</li>
    <li><code>msg.totalItemsAmount</code> - total items in array or object</li>
    <li><code>msg.originalMsg</code> - msg object, before array-map-start, it is not a copy, all mutations will be saved
    </li>
  </ul>
</script>
